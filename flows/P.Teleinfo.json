[
  {
    "id": "a1e22fa468f03c15",
    "type": "tab",
    "label": "P.Teleinfo",
    "disabled": false,
    "info": "",
    "env": []
  },
  {
    "id": "3df91d363faee835",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "name": "linky - bucket",
    "style": {
      "fill": "#ffC000",
      "fill-opacity": "0.05",
      "label": true,
      "stroke": "#ffC000"
    },
    "nodes": [
      "3325e4593048135a",
      "05787fb2b77146c8",
      "0ad08e9e45d5435d"
    ],
    "x": 94,
    "y": 19,
    "w": 342,
    "h": 82
  },
  {
    "id": "f7b8f0b4a2f0c6c9",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "name": "linky to influxdb",
    "style": {
      "fill": "#777777",
      "fill-opacity": "0.05",
      "label": true
    },
    "nodes": [
      "f65dfdda10900ffc",
      "b0150193e3cce710",
      "543a74289e049295",
      "213d292b79e5fbcc",
      "d0f7ea2cfc4571a3"
    ],
    "x": 68,
    "y": 1013,
    "w": 1574,
    "h": 2174
  },
  {
    "id": "8a97ad21fb974dbd",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "name": "catch error",
    "style": {
      "fill": "#ff0000",
      "fill-opacity": "0.05",
      "label": true,
      "stroke": "#ff0000"
    },
    "nodes": [
      "6f11b20b69a42029",
      "31fc5fdc93b7363d",
      "d7b616f51fec6d9a"
    ],
    "x": 534,
    "y": 19,
    "w": 422,
    "h": 82
  },
  {
    "id": "b9a706d9e4980c1e",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "name": "mqtt server for teleinfo",
    "style": {
      "fill": "#ffffff",
      "fill-opacity": "0.5",
      "label": true,
      "stroke": "#0070c0"
    },
    "nodes": [
      "fee31a77e542b203",
      "0bf16a20b9656c59"
    ],
    "x": 68,
    "y": 173,
    "w": 1824,
    "h": 194
  },
  {
    "id": "00e7c127dd88bf87",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "name": "enedis - linky",
    "style": {
      "fill": "#777777",
      "fill-opacity": "0.05",
      "label": true
    },
    "nodes": [
      "1585907d4d4bfa10",
      "23cddca4f42fed09",
      "dd17976080271c5b",
      "1a4d4ba352a6814f"
    ],
    "x": 68,
    "y": 413,
    "w": 2534,
    "h": 554
  },
  {
    "id": "f65dfdda10900ffc",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "f7b8f0b4a2f0c6c9",
    "name": "lecture teleinfo",
    "style": {
      "label": true,
      "fill": "#ff0000",
      "fill-opacity": "0.05"
    },
    "nodes": [
      "8546ac1e37b1b1fc",
      "1ef3db77515c5330",
      "df67aa8c4eb08c4b",
      "6b5f520afcf9e941",
      "1c6a5f6cf7a4171a",
      "e3ec96cdb6ecec1d",
      "2235915bcd1a9228",
      "df89dd445c170c34",
      "539176543f03340e",
      "528d193f3ad76c04",
      "d259cbfd50910254",
      "4f66f48da30fbb41",
      "5543b63f4f841d35",
      "16e115607aca11e2",
      "573b86bbb0b274cd",
      "6969a430e98620f8",
      "c40a25fa809f3f3f",
      "cad9f0d374763a50",
      "9846cd104deb4095",
      "80713009a92b1fb1",
      "25b8f66cb5486055",
      "25a206dee6cb2d38",
      "10352a4c8044bff8",
      "d1f398881a976c8c",
      "06b7f0862564450a"
    ],
    "x": 94,
    "y": 1039,
    "w": 1192,
    "h": 502
  },
  {
    "id": "b0150193e3cce710",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "f7b8f0b4a2f0c6c9",
    "name": "ecriture influxdb",
    "style": {
      "label": true,
      "fill": "#ff0000",
      "fill-opacity": "0.05"
    },
    "nodes": [
      "c2bbb4adbb91e2eb",
      "e340056f7c0ff7e6",
      "4f2f651b305df0d8",
      "f8e8e4320c84ad84",
      "b20175d86ac76169"
    ],
    "x": 94,
    "y": 2959,
    "w": 492,
    "h": 202
  },
  {
    "id": "543a74289e049295",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "f7b8f0b4a2f0c6c9",
    "name": "calcul pinst",
    "style": {
      "label": true,
      "fill": "#ff0000",
      "fill-opacity": "0.05"
    },
    "nodes": [
      "2c63586ece8ae18a",
      "543a55099b4d2327",
      "06e4c17b8ac467e1",
      "af3687a9f899e8da",
      "9a0856ef24c6ecb1",
      "905240083e6bd5a2",
      "e57340f8784de737",
      "1d84aac6c8e2a838",
      "eaf239f4e4fd9d20",
      "9a0a261261c064da",
      "ffd6cc9a833578f9",
      "fd73f58e64fd7772"
    ],
    "x": 94,
    "y": 1579,
    "w": 1522,
    "h": 142
  },
  {
    "id": "213d292b79e5fbcc",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "f7b8f0b4a2f0c6c9",
    "name": "Set l'index de chaque période à l'index courant au début de période",
    "style": {
      "label": true,
      "fill": "#ff0000",
      "fill-opacity": "0.05"
    },
    "nodes": [
      "c84ad49be11b1bd9",
      "1cde90641d601c65",
      "78a8877be3e75897",
      "2b15984780ad93da",
      "7e164b153068131f",
      "cdfbaf7f971088a0",
      "c77835080e9f86f2",
      "aaa4d5f3593d6d65",
      "f897b93a09482883",
      "6430485715d1b2a6",
      "8c5505de0a4d3dcd",
      "5b6872ce327b1bf3",
      "1cde90641d601c65"
    ],
    "x": 94,
    "y": 1759,
    "w": 892,
    "h": 562
  },
  {
    "id": "d0f7ea2cfc4571a3",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "f7b8f0b4a2f0c6c9",
    "name": "Compte le nombre d'indexes passé depuis le début de chaque période (toutes les minutes)",
    "style": {
      "label": true,
      "fill": "#ff0000",
      "fill-opacity": "0.05"
    },
    "nodes": [
      "82ef8057da8c77aa",
      "6c25a04857d1716e",
      "f2de43c0a6cb7bf1",
      "9a2254b818f75188",
      "86b0a6aba2f70fe6",
      "9bc81eccbc500c73",
      "997f6535a7397b5d",
      "c548f2f0529f2243",
      "b4e36b962e02a910",
      "38fbbacd76a1ebc8",
      "bcd49af0e6417d46",
      "7a20b1c05a7278f5"
    ],
    "x": 94,
    "y": 2359,
    "w": 802,
    "h": 562
  },
  {
    "id": "fee31a77e542b203",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "b9a706d9e4980c1e",
    "name": "devices teleinfo",
    "style": {
      "fill": "#0070c0",
      "fill-opacity": "0.05",
      "label": true
    },
    "nodes": [
      "c16f1ae420f44fb5",
      "b491f7eb02575108",
      "ca7f0d58c55a1358",
      "3423fd727184042c",
      "fa2acb5ac9bb8c8c",
      "a34aeb4c51bcf655"
    ],
    "x": 94,
    "y": 199,
    "w": 1162,
    "h": 142
  },
  {
    "id": "0bf16a20b9656c59",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "b9a706d9e4980c1e",
    "name": "",
    "style": {
      "fill": "#0070c0",
      "fill-opacity": "0.05",
      "label": true
    },
    "nodes": [
      "b0b2d9829230be99",
      "5d53068f8b9e6936",
      "a7e18f888c96ad05",
      "7a6db5a28141b284"
    ],
    "x": 1354,
    "y": 199,
    "w": 512,
    "h": 142
  },
  {
    "id": "1585907d4d4bfa10",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "00e7c127dd88bf87",
    "name": "teleinfo - linky - device",
    "style": {
      "fill": "#ffC000",
      "fill-opacity": "0.05",
      "label": true
    },
    "nodes": [
      "748e7d5f2122c46e",
      "1865300f7f6a496b",
      "3ef21f331dbced82",
      "dfed6c0bfa8e23dd",
      "f91f5e0c6aa9acbb",
      "30df3f5abb68ce44",
      "cf350545542b3cfb",
      "4b7ee33aecb98a13",
      "23093777025257b9",
      "136467c932bcd5c7",
      "74c0ed863d1f8308",
      "07ae64e387aaded3"
    ],
    "x": 534,
    "y": 439,
    "w": 962,
    "h": 502
  },
  {
    "id": "23cddca4f42fed09",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "00e7c127dd88bf87",
    "name": "teleinfo - linky - source",
    "style": {
      "fill": "#0070c0",
      "fill-opacity": "0.05",
      "label": true
    },
    "nodes": [
      "409a1c1265c25a4e",
      "57f7200daa8de303",
      "ab8a9f5e0f206718",
      "c18b40f57f3bc595",
      "8d777026352ee15e",
      "0bf7b4f1f0b6d706",
      "f125a16a38f72686",
      "509d71fa751432cf",
      "f2a4dd7129d6fbdf",
      "757738144261f6d1",
      "e7fd29793e5aef71",
      "b21521b6cbd2de78",
      "ca96add605101c24",
      "a735610c7cb844e6",
      "d111f1ba9ac15a3a",
      "2154dfc072f5104e"
    ],
    "x": 1594,
    "y": 439,
    "w": 982,
    "h": 442
  },
  {
    "id": "dd17976080271c5b",
    "type": "group",
    "z": "a1e22fa468f03c15",
    "g": "00e7c127dd88bf87",
    "name": "teleinfo - linky - model",
    "style": {
      "fill": "#001f60",
      "fill-opacity": "0.05",
      "label": true
    },
    "nodes": [
      "3d1e4fa0f23499e7",
      "0c56a7bbcdedc95c",
      "a8b3e0ae1a87461c"
    ],
    "x": 94,
    "y": 439,
    "w": 342,
    "h": 82
  },
  {
    "id": "3325e4593048135a",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "3df91d363faee835",
    "name": "bucket",
    "rules": [
      {
        "t": "set",
        "p": "bucket",
        "pt": "msg",
        "to": "linky",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "bucket",
        "pt": "flow",
        "to": "bucket",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 270,
    "y": 60,
    "wires": [
      [
        "0ad08e9e45d5435d"
      ]
    ]
  },
  {
    "id": "05787fb2b77146c8",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "g": "3df91d363faee835",
    "name": "linky - bucket",
    "links": [
      "25445f5a9b787a0a"
    ],
    "x": 135,
    "y": 60,
    "wires": [
      [
        "3325e4593048135a"
      ]
    ]
  },
  {
    "id": "0ad08e9e45d5435d",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "3df91d363faee835",
    "name": "linky - bucket",
    "mode": "link",
    "links": [
      "60a457c83fc5f610",
      "f5c52506bf786402",
      "484e035839639ba9"
    ],
    "x": 395,
    "y": 60,
    "wires": []
  },
  {
    "id": "8546ac1e37b1b1fc",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "type",
    "rules": [
      {
        "t": "set",
        "p": "payload.IINST",
        "pt": "msg",
        "to": "$number(msg.payload.IINST.value)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload.HCHC",
        "pt": "msg",
        "to": "$number(msg.payload.HCHC.value)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload.HCHP",
        "pt": "msg",
        "to": "$number(msg.payload.HCHP.value)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload.PAPP",
        "pt": "msg",
        "to": "$number(msg.payload.PAPP.value)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload.IMAX",
        "pt": "msg",
        "to": "$number(msg.payload.IMAX.value)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload.ISOUSC",
        "pt": "msg",
        "to": "$number(msg.payload.ISOUSC.value)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload.PTEC",
        "pt": "msg",
        "to": "payload.PTEC.value",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 270,
    "y": 1080,
    "wires": [
      [
        "539176543f03340e",
        "6969a430e98620f8"
      ]
    ]
  },
  {
    "id": "1ef3db77515c5330",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "teleinfo",
    "links": [
      "1f088dee7d4ae695",
      "b21521b6cbd2de78"
    ],
    "x": 135,
    "y": 1080,
    "wires": [
      [
        "8546ac1e37b1b1fc"
      ]
    ]
  },
  {
    "id": "df67aa8c4eb08c4b",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 930,
    "y": 1200,
    "wires": [
      [
        "9846cd104deb4095",
        "80713009a92b1fb1"
      ]
    ]
  },
  {
    "id": "6b5f520afcf9e941",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 930,
    "y": 1140,
    "wires": [
      [
        "80713009a92b1fb1"
      ]
    ]
  },
  {
    "id": "1c6a5f6cf7a4171a",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "septopics": true,
    "property": "payload",
    "topi": "topic",
    "x": 930,
    "y": 1440,
    "wires": [
      [
        "80713009a92b1fb1"
      ]
    ]
  },
  {
    "id": "e3ec96cdb6ecec1d",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 930,
    "y": 1260,
    "wires": [
      [
        "cad9f0d374763a50",
        "80713009a92b1fb1"
      ]
    ]
  },
  {
    "id": "2235915bcd1a9228",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 930,
    "y": 1320,
    "wires": [
      [
        "c40a25fa809f3f3f",
        "80713009a92b1fb1"
      ]
    ]
  },
  {
    "id": "df89dd445c170c34",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 930,
    "y": 1500,
    "wires": [
      [
        "80713009a92b1fb1"
      ]
    ]
  },
  {
    "id": "539176543f03340e",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "1msg/2s",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "2",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "outputs": 1,
    "x": 440,
    "y": 1440,
    "wires": [
      [
        "528d193f3ad76c04",
        "d259cbfd50910254"
      ]
    ]
  },
  {
    "id": "528d193f3ad76c04",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "PAPP",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "puissance",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.PAPP",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "W",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 610,
    "y": 1500,
    "wires": [
      [
        "06b7f0862564450a"
      ]
    ]
  },
  {
    "id": "d259cbfd50910254",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "IINST",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "intensite",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.IINST",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "A",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 610,
    "y": 1440,
    "wires": [
      [
        "1c6a5f6cf7a4171a"
      ]
    ]
  },
  {
    "id": "4f66f48da30fbb41",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "INDEX HC WH",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "index_hc",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.HCHC",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "Wh",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 640,
    "y": 1320,
    "wires": [
      [
        "2235915bcd1a9228"
      ]
    ]
  },
  {
    "id": "5543b63f4f841d35",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "INDEX HP WH",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "index_hp",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.HCHP",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "Wh",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 640,
    "y": 1260,
    "wires": [
      [
        "e3ec96cdb6ecec1d"
      ]
    ]
  },
  {
    "id": "16e115607aca11e2",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "INDEX TT KWH",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "index_total",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "(msg.payload.HCHC+ msg.payload.HCHP) / 1000",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "kWh",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 640,
    "y": 1140,
    "wires": [
      [
        "6b5f520afcf9e941"
      ]
    ]
  },
  {
    "id": "573b86bbb0b274cd",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "INDEX TT WH",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "index_total",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "msg.payload.HCHC+ msg.payload.HCHP",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "Wh",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 640,
    "y": 1200,
    "wires": [
      [
        "df67aa8c4eb08c4b"
      ]
    ]
  },
  {
    "id": "6969a430e98620f8",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "1msg/15s",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "15",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "outputs": 1,
    "x": 440,
    "y": 1140,
    "wires": [
      [
        "4f66f48da30fbb41",
        "5543b63f4f841d35",
        "16e115607aca11e2",
        "573b86bbb0b274cd",
        "25a206dee6cb2d38"
      ]
    ]
  },
  {
    "id": "c40a25fa809f3f3f",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hc_wh",
        "pt": "flow",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1150,
    "y": 1320,
    "wires": [
      []
    ]
  },
  {
    "id": "cad9f0d374763a50",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hp_wh",
        "pt": "flow",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1150,
    "y": 1260,
    "wires": [
      []
    ]
  },
  {
    "id": "9846cd104deb4095",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_total_wh",
        "pt": "flow",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1150,
    "y": 1200,
    "wires": [
      []
    ]
  },
  {
    "id": "80713009a92b1fb1",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "format",
    "rules": [
      {
        "t": "set",
        "p": "tmp",
        "pt": "msg",
        "to": "payload",
        "tot": "msg"
      },
      {
        "t": "delete",
        "p": "payload",
        "pt": "msg"
      },
      {
        "t": "set",
        "p": "payload[0]",
        "pt": "msg",
        "to": "{msg.field:msg.tmp}",
        "tot": "jsonata"
      },
      {
        "t": "delete",
        "p": "tmp",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 1080,
    "wires": [
      [
        "25b8f66cb5486055"
      ]
    ]
  },
  {
    "id": "25b8f66cb5486055",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "influxdb",
    "links": [
      "e340056f7c0ff7e6"
    ],
    "x": 1215,
    "y": 1080,
    "wires": []
  },
  {
    "id": "25a206dee6cb2d38",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "PTEC",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "tarif_hp",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.PTEC",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "T",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 610,
    "y": 1380,
    "wires": [
      [
        "10352a4c8044bff8"
      ]
    ]
  },
  {
    "id": "10352a4c8044bff8",
    "type": "function",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "HPHC",
    "func": "if (msg.payload==\"HP\"){\n    msg.payload=1;\n    return msg;\n}\nelse if(msg.payload==\"HC\"){\n    msg.payload=0;\n    return msg;\n}",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 770,
    "y": 1380,
    "wires": [
      [
        "d1f398881a976c8c"
      ]
    ]
  },
  {
    "id": "d1f398881a976c8c",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 930,
    "y": 1380,
    "wires": [
      [
        "80713009a92b1fb1"
      ]
    ]
  },
  {
    "id": "e340056f7c0ff7e6",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "g": "b0150193e3cce710",
    "name": "influxdb",
    "links": [
      "1d84aac6c8e2a838",
      "25b8f66cb5486055",
      "f2de43c0a6cb7bf1"
    ],
    "x": 135,
    "y": 3060,
    "wires": [
      [
        "4f2f651b305df0d8"
      ]
    ]
  },
  {
    "id": "4f2f651b305df0d8",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "b0150193e3cce710",
    "name": "50ms",
    "pauseType": "delay",
    "timeout": "50",
    "timeoutUnits": "milliseconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "outputs": 1,
    "x": 270,
    "y": 3060,
    "wires": [
      [
        "c2bbb4adbb91e2eb",
        "f8e8e4320c84ad84",
        "b20175d86ac76169"
      ]
    ]
  },
  {
    "id": "f8e8e4320c84ad84",
    "type": "debug",
    "z": "a1e22fa468f03c15",
    "g": "b0150193e3cce710",
    "name": "linky to influxdb",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 460,
    "y": 3000,
    "wires": []
  },
  {
    "id": "b20175d86ac76169",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "b0150193e3cce710",
    "name": "increment influxdb stat",
    "mode": "link",
    "links": [
      "b4dcaf3216134966"
    ],
    "x": 395,
    "y": 3060,
    "wires": []
  },
  {
    "id": "06e4c17b8ac467e1",
    "type": "join",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "",
    "mode": "custom",
    "build": "object",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "accumulate": false,
    "timeout": "",
    "count": "2",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "",
    "reduceFixup": "",
    "x": 780,
    "y": 1620,
    "wires": [
      [
        "9a0a261261c064da"
      ]
    ]
  },
  {
    "id": "af3687a9f899e8da",
    "type": "function",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "",
    "func": "var old = msg.payload.old.value;\nvar current = msg.payload.new.value;\nvar diff_index = current - old;\n\n\nvar diff_seconds = (msg.payload.new.time - msg.payload.old.time) / 1000;\nif (diff_seconds == 0) {\n    var conso = 0;\n} else {\n    var coeff = diff_seconds / 3600\n    var conso = diff_index / coeff\n    conso = Math.round(conso*100)/100\n}\nvar msg2 = {};\nmsg2.payload = {};\nmsg2.payload.conso = conso;\nmsg2.payload.diff_sec = diff_seconds;\nmsg2.payload.old_time = msg.payload.old.time;\nmsg2.payload.new_time = msg.payload.new.time;\n\nnode.status({fill: \"green\", shape: \"ring\", text: conso});\nreturn msg2;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1280,
    "y": 1620,
    "wires": [
      [
        "eaf239f4e4fd9d20"
      ]
    ]
  },
  {
    "id": "9a0856ef24c6ecb1",
    "type": "inject",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "90",
    "crontab": "",
    "once": true,
    "onceDelay": "30",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 210,
    "y": 1620,
    "wires": [
      [
        "2c63586ece8ae18a",
        "543a55099b4d2327"
      ]
    ]
  },
  {
    "id": "905240083e6bd5a2",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "old",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "old",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "tmp",
        "pt": "msg",
        "to": "{}",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "tmp.value",
        "pt": "msg",
        "to": "payload[0]._value",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "tmp.time",
        "pt": "msg",
        "to": "$toMillis(msg.payload[0]._time)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "tmp",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 610,
    "y": 1620,
    "wires": [
      [
        "06e4c17b8ac467e1"
      ]
    ]
  },
  {
    "id": "e57340f8784de737",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "new",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "new",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "tmp",
        "pt": "msg",
        "to": "{}",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "tmp.value",
        "pt": "msg",
        "to": "payload[0]._value",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "tmp.time",
        "pt": "msg",
        "to": "$toMillis(msg.payload[0]._time)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "tmp",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 610,
    "y": 1680,
    "wires": [
      [
        "06e4c17b8ac467e1"
      ]
    ]
  },
  {
    "id": "1d84aac6c8e2a838",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "influxdb",
    "links": [
      "e340056f7c0ff7e6"
    ],
    "x": 1575,
    "y": 1620,
    "wires": []
  },
  {
    "id": "eaf239f4e4fd9d20",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "format",
    "rules": [
      {
        "t": "set",
        "p": "conso",
        "pt": "msg",
        "to": "$number(msg.payload.conso)",
        "tot": "jsonata"
      },
      {
        "t": "delete",
        "p": "payload",
        "pt": "msg"
      },
      {
        "t": "set",
        "p": "payload[0]",
        "pt": "msg",
        "to": "{\"conso_puissance\":msg.conso}",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "W",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1450,
    "y": 1620,
    "wires": [
      [
        "1d84aac6c8e2a838"
      ]
    ]
  },
  {
    "id": "c84ad49be11b1bd9",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_total_wh_start_day",
        "pt": "flow",
        "to": "index_total_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 1800,
    "wires": [
      []
    ]
  },
  {
    "id": "78a8877be3e75897",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_total_wh_start_month",
        "pt": "flow",
        "to": "index_total_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 800,
    "y": 1860,
    "wires": [
      []
    ]
  },
  {
    "id": "2b15984780ad93da",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_total_wh_start_year",
        "pt": "flow",
        "to": "index_total_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 1920,
    "wires": [
      []
    ]
  },
  {
    "id": "7e164b153068131f",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "period select",
    "property": "topic",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "day",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "month",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "year",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 510,
    "y": 1860,
    "wires": [
      [
        "c84ad49be11b1bd9",
        "c77835080e9f86f2",
        "5b6872ce327b1bf3"
      ],
      [
        "78a8877be3e75897",
        "aaa4d5f3593d6d65",
        "8c5505de0a4d3dcd"
      ],
      [
        "2b15984780ad93da",
        "f897b93a09482883",
        "6430485715d1b2a6"
      ]
    ]
  },
  {
    "id": "cdfbaf7f971088a0",
    "type": "inject",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "Manual init >> DO NOT PRESS UNTIL REALLY NEEDED >>",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 360,
    "y": 2280,
    "wires": [
      [
        "c84ad49be11b1bd9",
        "78a8877be3e75897",
        "2b15984780ad93da",
        "c77835080e9f86f2",
        "aaa4d5f3593d6d65",
        "f897b93a09482883",
        "5b6872ce327b1bf3",
        "8c5505de0a4d3dcd",
        "6430485715d1b2a6"
      ]
    ]
  },
  {
    "id": "c77835080e9f86f2",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hp_wh_start_day",
        "pt": "flow",
        "to": "index_hp_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 1980,
    "wires": [
      []
    ]
  },
  {
    "id": "aaa4d5f3593d6d65",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hp_wh_start_month",
        "pt": "flow",
        "to": "index_hp_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 2040,
    "wires": [
      []
    ]
  },
  {
    "id": "f897b93a09482883",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hp_wh_start_year",
        "pt": "flow",
        "to": "index_hp_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 2100,
    "wires": [
      []
    ]
  },
  {
    "id": "6430485715d1b2a6",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hc_wh_start_year",
        "pt": "flow",
        "to": "index_hc_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 2280,
    "wires": [
      []
    ]
  },
  {
    "id": "8c5505de0a4d3dcd",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hc_wh_start_month",
        "pt": "flow",
        "to": "index_hc_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 2220,
    "wires": [
      []
    ]
  },
  {
    "id": "5b6872ce327b1bf3",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "index_hc_wh_start_day",
        "pt": "flow",
        "to": "index_hc_wh",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 2160,
    "wires": [
      []
    ]
  },
  {
    "id": "82ef8057da8c77aa",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_total_wh_end_day",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_total_day",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_total_wh_start_day",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_total_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_total_wh_end_day",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 2400,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "6c25a04857d1716e",
    "type": "inject",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "60",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 210,
    "y": 2400,
    "wires": [
      [
        "82ef8057da8c77aa",
        "86b0a6aba2f70fe6",
        "9bc81eccbc500c73",
        "997f6535a7397b5d",
        "b4e36b962e02a910",
        "38fbbacd76a1ebc8",
        "bcd49af0e6417d46",
        "7a20b1c05a7278f5",
        "c548f2f0529f2243"
      ]
    ]
  },
  {
    "id": "f2de43c0a6cb7bf1",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "influxdb",
    "links": [
      "e340056f7c0ff7e6"
    ],
    "x": 855,
    "y": 2400,
    "wires": []
  },
  {
    "id": "9a2254b818f75188",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "format",
    "rules": [
      {
        "t": "set",
        "p": "index",
        "pt": "msg",
        "to": "payload",
        "tot": "msg"
      },
      {
        "t": "delete",
        "p": "payload",
        "pt": "msg"
      },
      {
        "t": "set",
        "p": "payload[0]",
        "pt": "msg",
        "to": "{msg.field:msg.index}",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "Wh",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 730,
    "y": 2400,
    "wires": [
      [
        "f2de43c0a6cb7bf1"
      ]
    ]
  },
  {
    "id": "86b0a6aba2f70fe6",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_total_wh_end_month",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_total_month",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_total_wh_start_month",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_total_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_total_wh_end_month",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 460,
    "y": 2460,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "9bc81eccbc500c73",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_total_wh_end_year",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_total_year",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_total_wh_start_year",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_total_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_total_wh_end_year",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 2520,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "997f6535a7397b5d",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_hp_wh_end_day",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_hp_day",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_hp_wh_start_day",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_hp_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_hp_wh_end_day",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 2580,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "c548f2f0529f2243",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_hp_wh_end_month",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_hp_month",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_hp_wh_start_month",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_hp_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_hp_wh_end_month",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 2640,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "b4e36b962e02a910",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_hp_wh_end_year",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_hp_year",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_hp_wh_start_year",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_hp_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_hp_wh_end_year",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 2700,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "38fbbacd76a1ebc8",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_hc_wh_end_day",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_hc_day",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_hc_wh_start_day",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_hc_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_hc_wh_end_day",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 440,
    "y": 2760,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "bcd49af0e6417d46",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_hc_wh_end_month",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_hc_month",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_hc_wh_start_month",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_hc_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_hc_wh_end_month",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 2820,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "7a20b1c05a7278f5",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "d0f7ea2cfc4571a3",
    "name": "index_hc_wh_end_year",
    "rules": [
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "conso_hc_year",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "start",
        "pt": "msg",
        "to": "index_hc_wh_start_year",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "end",
        "pt": "msg",
        "to": "index_hc_wh",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.end) - $number(msg.start)",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "index_hc_wh_end_year",
        "pt": "flow",
        "to": "end",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 2880,
    "wires": [
      [
        "9a2254b818f75188"
      ]
    ]
  },
  {
    "id": "c2bbb4adbb91e2eb",
    "type": "influxdb out",
    "z": "a1e22fa468f03c15",
    "g": "b0150193e3cce710",
    "influxdb": "e408b55d1dc6870d",
    "name": "linky",
    "measurement": "",
    "precision": "",
    "retentionPolicy": "",
    "database": "",
    "precisionV18FluxV20": "s",
    "retentionPolicyV18Flux": "",
    "org": "iotredloop",
    "bucket": "linky",
    "x": 430,
    "y": 3120,
    "wires": []
  },
  {
    "id": "2c63586ece8ae18a",
    "type": "influxdb in",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "influxdb": "e408b55d1dc6870d",
    "name": "2min ago index",
    "query": "from(bucket: \"linky\")\n  |> range(start: -120s, stop: now())\n  |> filter(fn: (r) => r[\"_field\"] == \"index_total\" and r[\"_measurement\"] == \"Wh\")\n  |> aggregateWindow(every: 1s, fn: last, createEmpty: false)\n  |> sort(columns: [\"_time\"], desc: false)\n  |> yield(name: \"last\")",
    "rawOutput": false,
    "precision": "",
    "retentionPolicy": "",
    "org": "iotredloop",
    "x": 420,
    "y": 1620,
    "wires": [
      [
        "905240083e6bd5a2"
      ]
    ]
  },
  {
    "id": "543a55099b4d2327",
    "type": "influxdb in",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "influxdb": "e408b55d1dc6870d",
    "name": "last index",
    "query": "from(bucket: \"linky\")\n  |> range(start: -60s, stop: now())\n  |> filter(fn: (r) => r[\"_field\"] == \"index_total\" and r[\"_measurement\"] == \"Wh\")\n  |> aggregateWindow(every: 1s, fn: last, createEmpty: false)\n  |> sort(columns: [\"_time\"], desc: true)\n  |> yield(name: \"last\")",
    "rawOutput": false,
    "precision": "",
    "retentionPolicy": "",
    "org": "iotredloop",
    "x": 400,
    "y": 1680,
    "wires": [
      [
        "e57340f8784de737"
      ]
    ]
  },
  {
    "id": "1cde90641d601c65",
    "type": "cronplus",
    "z": "a1e22fa468f03c15",
    "g": "213d292b79e5fbcc",
    "name": "start periods",
    "outputField": "payload",
    "timeZone": "",
    "storeName": "",
    "commandResponseMsgOutput": "output2",
    "defaultLocation": "",
    "defaultLocationType": "default",
    "outputs": 2,
    "options": [
      {
        "name": "day",
        "topic": "day",
        "payloadType": "default",
        "payload": "",
        "expressionType": "cron",
        "expression": "0 0 0 * * ? *",
        "location": "",
        "offset": "0",
        "solarType": "all",
        "solarEvents": "sunrise,sunset"
      },
      {
        "name": "month",
        "topic": "month",
        "payloadType": "default",
        "payload": "",
        "expressionType": "cron",
        "expression": "0 0 0 1 * ? *",
        "location": "",
        "offset": "0",
        "solarType": "all",
        "solarEvents": "sunrise,sunset"
      },
      {
        "name": "year",
        "topic": "year",
        "payloadType": "default",
        "payload": "",
        "expressionType": "cron",
        "expression": "0 0 0 1 1 ? *",
        "location": "",
        "offset": "0",
        "solarType": "all",
        "solarEvents": "sunrise,sunset"
      }
    ],
    "x": 210,
    "y": 1860,
    "wires": [
      [
        "7e164b153068131f"
      ],
      []
    ]
  },
  {
    "id": "6f11b20b69a42029",
    "type": "catch",
    "z": "a1e22fa468f03c15",
    "g": "8a97ad21fb974dbd",
    "name": "catch error",
    "scope": null,
    "uncaught": false,
    "x": 620,
    "y": 60,
    "wires": [
      [
        "31fc5fdc93b7363d"
      ]
    ]
  },
  {
    "id": "31fc5fdc93b7363d",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "8a97ad21fb974dbd",
    "name": "topic",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "linky",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 790,
    "y": 60,
    "wires": [
      [
        "d7b616f51fec6d9a"
      ]
    ]
  },
  {
    "id": "d7b616f51fec6d9a",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "8a97ad21fb974dbd",
    "name": "catch error",
    "mode": "link",
    "links": [
      "a52f0e788cd4dca3"
    ],
    "x": 915,
    "y": 60,
    "wires": []
  },
  {
    "id": "c16f1ae420f44fb5",
    "type": "mqtt in",
    "z": "a1e22fa468f03c15",
    "g": "fee31a77e542b203",
    "name": "MQTT teleinfo",
    "topic": "teleinfo/#",
    "qos": "2",
    "datatype": "auto-detect",
    "broker": "d6ba6007b1901314",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 190,
    "y": 240,
    "wires": [
      [
        "fa2acb5ac9bb8c8c"
      ]
    ]
  },
  {
    "id": "b491f7eb02575108",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "fee31a77e542b203",
    "name": "mqtt teleinfo",
    "mode": "link",
    "links": [
      "acc79920bf40652d",
      "ba77500cd9f7f6da"
    ],
    "x": 1215,
    "y": 240,
    "wires": []
  },
  {
    "id": "ca7f0d58c55a1358",
    "type": "q-gate",
    "z": "a1e22fa468f03c15",
    "g": "fee31a77e542b203",
    "name": "",
    "controlTopic": "gate",
    "defaultState": "queueing",
    "openCmd": "open",
    "closeCmd": "close",
    "toggleCmd": "toggle",
    "queueCmd": "close",
    "defaultCmd": "default",
    "triggerCmd": "trigger",
    "flushCmd": "open",
    "resetCmd": "reset",
    "peekCmd": "peek",
    "dropCmd": "drop",
    "statusCmd": "status",
    "maxQueueLength": "0",
    "keepNewest": false,
    "qToggle": false,
    "persist": false,
    "storeName": "default",
    "x": 590,
    "y": 240,
    "wires": [
      [
        "a34aeb4c51bcf655"
      ]
    ]
  },
  {
    "id": "3423fd727184042c",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "g": "fee31a77e542b203",
    "name": "mqtt teleinfo gate",
    "links": [
      "d68d686bbf684c95",
      "8fdb5986494986cc"
    ],
    "x": 455,
    "y": 300,
    "wires": [
      [
        "ca7f0d58c55a1358"
      ]
    ]
  },
  {
    "id": "fa2acb5ac9bb8c8c",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "fee31a77e542b203",
    "name": "20 msg / s",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "20",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 390,
    "y": 240,
    "wires": [
      [
        "ca7f0d58c55a1358"
      ]
    ]
  },
  {
    "id": "a34aeb4c51bcf655",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "fee31a77e542b203",
    "name": "raz MQTT properties",
    "rules": [
      {
        "t": "delete",
        "p": "qos",
        "pt": "msg"
      },
      {
        "t": "delete",
        "p": "retain",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1040,
    "y": 240,
    "wires": [
      [
        "b491f7eb02575108"
      ]
    ]
  },
  {
    "id": "b0b2d9829230be99",
    "type": "mqtt out",
    "z": "a1e22fa468f03c15",
    "g": "0bf16a20b9656c59",
    "name": "MQTT teleinfo",
    "topic": "",
    "qos": "",
    "retain": "",
    "respTopic": "",
    "contentType": "",
    "userProps": "",
    "correl": "",
    "expiry": "",
    "broker": "d6ba6007b1901314",
    "x": 1760,
    "y": 240,
    "wires": []
  },
  {
    "id": "5d53068f8b9e6936",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "d": true,
    "g": "0bf16a20b9656c59",
    "name": "mqtt teleinfo",
    "links": [],
    "x": 1395,
    "y": 240,
    "wires": [
      [
        "7a6db5a28141b284"
      ]
    ]
  },
  {
    "id": "a7e18f888c96ad05",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "0bf16a20b9656c59",
    "name": "mqtt teleinfo output",
    "mode": "link",
    "links": [],
    "x": 1695,
    "y": 300,
    "wires": []
  },
  {
    "id": "7a6db5a28141b284",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "0bf16a20b9656c59",
    "name": "check topic",
    "property": "topic",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "^teleinfo",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 1550,
    "y": 240,
    "wires": [
      [
        "b0b2d9829230be99",
        "a7e18f888c96ad05"
      ]
    ]
  },
  {
    "id": "06b7f0862564450a",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "f65dfdda10900ffc",
    "name": "inject",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 2,
    "x": 770,
    "y": 1500,
    "wires": [
      [
        "80713009a92b1fb1"
      ],
      [
        "df89dd445c170c34"
      ]
    ]
  },
  {
    "id": "9a0a261261c064da",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "new",
    "property": "payload.new",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 950,
    "y": 1620,
    "wires": [
      [
        "ffd6cc9a833578f9"
      ]
    ]
  },
  {
    "id": "ffd6cc9a833578f9",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "old",
    "property": "payload.old",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 1110,
    "y": 1620,
    "wires": [
      [
        "af3687a9f899e8da"
      ]
    ]
  },
  {
    "id": "fd73f58e64fd7772",
    "type": "comment",
    "z": "a1e22fa468f03c15",
    "g": "543a74289e049295",
    "name": "",
    "info": "",
    "x": 790,
    "y": 1680,
    "wires": []
  },
  {
    "id": "748e7d5f2122c46e",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "current / electric meter* / number / 0",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "current",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "number",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 960,
    "y": 540,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  },
  {
    "id": "1865300f7f6a496b",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "power / electric meter* / number / 0",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "power",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "number",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 960,
    "y": 600,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  },
  {
    "id": "3ef21f331dbced82",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "off-peak hours counter / electric meter* / number / 0",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "off-peak hours counter",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "number",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1010,
    "y": 780,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  },
  {
    "id": "dfed6c0bfa8e23dd",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "peak hours counter / electric meter* / number / 0",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "peak hours counter",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "number",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1000,
    "y": 720,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  },
  {
    "id": "f91f5e0c6aa9acbb",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "total hours counter / electric meter* / number / 0",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "total hours counter",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "number",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1000,
    "y": 840,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  },
  {
    "id": "30df3f5abb68ce44",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "tariff / electric meter* / text / HP",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "tariff",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "text",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "HP",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 950,
    "y": 660,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  },
  {
    "id": "409a1c1265c25a4e",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "current",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "current",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.payload.IINST.value)",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2100,
    "y": 480,
    "wires": [
      [
        "e7fd29793e5aef71"
      ]
    ]
  },
  {
    "id": "57f7200daa8de303",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "power",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "power",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.payload.PAPP.value)",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2090,
    "y": 540,
    "wires": [
      [
        "e7fd29793e5aef71"
      ]
    ]
  },
  {
    "id": "ab8a9f5e0f206718",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "limit 1 msg / m",
    "pauseType": "rate",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 2380,
    "y": 660,
    "wires": [
      [
        "2154dfc072f5104e"
      ]
    ]
  },
  {
    "id": "c18b40f57f3bc595",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "limit 1 msg / m",
    "pauseType": "rate",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 2380,
    "y": 720,
    "wires": [
      [
        "2154dfc072f5104e"
      ]
    ]
  },
  {
    "id": "8d777026352ee15e",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "limit 1 msg / m",
    "pauseType": "rate",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 2380,
    "y": 780,
    "wires": [
      [
        "2154dfc072f5104e"
      ]
    ]
  },
  {
    "id": "0bf7b4f1f0b6d706",
    "type": "delay",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "limit 1 msg / m",
    "pauseType": "rate",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "minute",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 2380,
    "y": 600,
    "wires": [
      [
        "2154dfc072f5104e"
      ]
    ]
  },
  {
    "id": "f125a16a38f72686",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "tariff",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "tariff",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.PTEC.value",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "repeat",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2090,
    "y": 600,
    "wires": [
      [
        "0bf7b4f1f0b6d706"
      ]
    ]
  },
  {
    "id": "509d71fa751432cf",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "peak hours counter",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "peak hours counter",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.payload.HCHP.value)",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2130,
    "y": 660,
    "wires": [
      [
        "ab8a9f5e0f206718"
      ]
    ]
  },
  {
    "id": "f2a4dd7129d6fbdf",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "off-peak hours counter",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "off-peak hours counter",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.payload.HCHC.value)",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2140,
    "y": 720,
    "wires": [
      [
        "c18b40f57f3bc595"
      ]
    ]
  },
  {
    "id": "757738144261f6d1",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "total hours counter",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "total hours counter",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$number(msg.payload.HCHC.value) + $number(msg.payload.HCHP.value)",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2130,
    "y": 780,
    "wires": [
      [
        "8d777026352ee15e"
      ]
    ]
  },
  {
    "id": "e7fd29793e5aef71",
    "type": "rbe",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "only changes",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "septopics": true,
    "property": "payload",
    "topi": "topic",
    "x": 2290,
    "y": 480,
    "wires": [
      [
        "2154dfc072f5104e"
      ]
    ]
  },
  {
    "id": "b21521b6cbd2de78",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "teleinfo - linky - source passthrough",
    "mode": "link",
    "links": [
      "1ef3db77515c5330"
    ],
    "x": 2055,
    "y": 840,
    "wires": []
  },
  {
    "id": "23093777025257b9",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "protocol",
    "rules": [
      {
        "t": "set",
        "p": "protocol",
        "pt": "msg",
        "to": "teleinfo",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 480,
    "wires": [
      [
        "136467c932bcd5c7"
      ]
    ]
  },
  {
    "id": "4b7ee33aecb98a13",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "teleinfo - linky - device",
    "links": [
      "546f190f3ec0c90d"
    ],
    "x": 575,
    "y": 480,
    "wires": [
      [
        "cf350545542b3cfb"
      ]
    ]
  },
  {
    "id": "cf350545542b3cfb",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "model",
    "property": "model",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "linky",
        "vt": "str"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 690,
    "y": 480,
    "wires": [
      [
        "748e7d5f2122c46e",
        "1865300f7f6a496b",
        "30df3f5abb68ce44",
        "dfed6c0bfa8e23dd",
        "3ef21f331dbced82",
        "f91f5e0c6aa9acbb",
        "74c0ed863d1f8308",
        "07ae64e387aaded3"
      ]
    ]
  },
  {
    "id": "136467c932bcd5c7",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "teleinfo - linky - device",
    "mode": "link",
    "links": [
      "3e1b4213132404be"
    ],
    "x": 1455,
    "y": 480,
    "wires": []
  },
  {
    "id": "a735610c7cb844e6",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "teleinfo - linky - source",
    "links": [
      "24058eec92534b27"
    ],
    "x": 1635,
    "y": 480,
    "wires": [
      [
        "d111f1ba9ac15a3a"
      ]
    ]
  },
  {
    "id": "d111f1ba9ac15a3a",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "model",
    "property": "model",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "linky",
        "vt": "str"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 1770,
    "y": 480,
    "wires": [
      [
        "ca96add605101c24"
      ]
    ]
  },
  {
    "id": "ca96add605101c24",
    "type": "switch",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "topic",
    "property": "topic",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "prefix",
        "vt": "msg"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 1930,
    "y": 480,
    "wires": [
      [
        "409a1c1265c25a4e",
        "57f7200daa8de303",
        "f125a16a38f72686",
        "509d71fa751432cf",
        "f2a4dd7129d6fbdf",
        "757738144261f6d1",
        "b21521b6cbd2de78"
      ]
    ]
  },
  {
    "id": "2154dfc072f5104e",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "23cddca4f42fed09",
    "name": "teleinfo - linky - source",
    "mode": "link",
    "links": [
      "14a0a0839924964f"
    ],
    "x": 2535,
    "y": 480,
    "wires": []
  },
  {
    "id": "3d1e4fa0f23499e7",
    "type": "link in",
    "z": "a1e22fa468f03c15",
    "g": "dd17976080271c5b",
    "name": "teleinfo - linky model",
    "links": [
      "9cb906bf8066d37e"
    ],
    "x": 135,
    "y": 480,
    "wires": [
      [
        "0c56a7bbcdedc95c"
      ]
    ]
  },
  {
    "id": "0c56a7bbcdedc95c",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "dd17976080271c5b",
    "name": "model",
    "rules": [
      {
        "t": "set",
        "p": "brand",
        "pt": "msg",
        "to": "enedis",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "model",
        "pt": "msg",
        "to": "linky",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "protocol",
        "pt": "msg",
        "to": "teleinfo",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "power",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "electric meter",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "number",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 270,
    "y": 480,
    "wires": [
      [
        "a8b3e0ae1a87461c"
      ]
    ]
  },
  {
    "id": "a8b3e0ae1a87461c",
    "type": "link out",
    "z": "a1e22fa468f03c15",
    "g": "dd17976080271c5b",
    "name": "teleinfo - linky model",
    "mode": "link",
    "links": [
      "94aa726ce8973d2c"
    ],
    "x": 395,
    "y": 480,
    "wires": []
  },
  {
    "id": "74c0ed863d1f8308",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "brand: enedis /.electric meter* / power",
    "rules": [
      {
        "t": "set",
        "p": "brand",
        "pt": "msg",
        "to": "enedis",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "power",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 970,
    "y": 480,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  },
  {
    "id": "1a4d4ba352a6814f",
    "type": "comment",
    "z": "a1e22fa468f03c15",
    "g": "00e7c127dd88bf87",
    "name": "power  / electric meter",
    "info": "",
    "x": 220,
    "y": 560,
    "wires": []
  },
  {
    "id": "07ae64e387aaded3",
    "type": "change",
    "z": "a1e22fa468f03c15",
    "g": "1585907d4d4bfa10",
    "name": "overload / electric meter* / boolean / false",
    "rules": [
      {
        "t": "set",
        "p": "measurement",
        "pt": "msg",
        "to": "overload",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "field",
        "pt": "msg",
        "to": "msg.field?msg.field:'electric meter'",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "format",
        "pt": "msg",
        "to": "boolean",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "default",
        "pt": "msg",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 980,
    "y": 900,
    "wires": [
      [
        "23093777025257b9"
      ]
    ]
  }
]